const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/UPNG-E7GzKVo-.js","assets/react-i3Ujj7hp.js","assets/_commonjs-dynamic-modules-TDtrdbi3.js","assets/svgo-node-DQa_Azu-.js"])))=>i.map(i=>d[i]);
import{j as t,I as se,R as M,T as ne,r as S,a as D,b as k,S as K,c as T,d as B,e as re,f as ie}from"./react-i3Ujj7hp.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();const w=[];for(let e=0;e<256;++e)w.push((e+256).toString(16).slice(1));function oe(e,s=0){return(w[e[s+0]]+w[e[s+1]]+w[e[s+2]]+w[e[s+3]]+"-"+w[e[s+4]]+w[e[s+5]]+"-"+w[e[s+6]]+w[e[s+7]]+"-"+w[e[s+8]]+w[e[s+9]]+"-"+w[e[s+10]]+w[e[s+11]]+w[e[s+12]]+w[e[s+13]]+w[e[s+14]]+w[e[s+15]]).toLowerCase()}let C;const ae=new Uint8Array(16);function ce(){if(!C){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");C=crypto.getRandomValues.bind(crypto)}return C(ae)}const le=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),F={randomUUID:le};function de(e,s,i){var n;if(F.randomUUID&&!e)return F.randomUUID();e=e||{};const r=e.random??((n=e.rng)==null?void 0:n.call(e))??ce();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,oe(r)}function ue(){return t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),t.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})}function he(){return t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M3 6h18"}),t.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),t.jsx("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})}function me(){return t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t.jsx("polyline",{points:"7 10 12 15 17 10"}),t.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})}function pe(e){if(e===0)return"0 Bytes";const s=1024,i=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(s));return`${parseFloat((e/Math.pow(s,r)).toFixed(2))} ${i[r]}`}async function ge(e){return navigator.clipboard?await navigator.clipboard.writeText(e):new Promise((s,i)=>{const r=document.createElement("textarea");r.value=e,r.style.position="fixed",document.body.appendChild(r),r.select();try{const n=document.execCommand("copy");document.body.removeChild(r),n?s({}):i(new Error("复制命令失败"))}catch(n){document.body.removeChild(r),i(n)}})}function fe(e){return new Promise(s=>{const i=new Image;i.onload=()=>{s({width:i.width,height:i.height})},i.src=e})}function xe(e){return new Promise((s,i)=>{const r=new FileReader;r.onloadend=()=>{s(r.result)},r.onerror=()=>{i(new Error("Base64转换失败"))},r.readAsDataURL(e)})}function ve(e){return new Promise(s=>setTimeout(s,e))}var h=(e=>(e.SAME="same",e.AVIF="avif",e.JPEG="jpg",e.PNG="png",e.WEBP="webp",e.SVG="svg",e.UNKNOWN="unknown",e))(h||{}),L=(e=>(e.AVIF="image/avif",e.JPEG="image/jpeg",e.PNG="png",e.WEBP="webp",e.SVG="image/svg+xml",e))(L||{}),U=(e=>(e.RATIO="ratio",e.WIDTH="width",e))(U||{});function O(e){return e==="image/avif"?h.AVIF:e==="image/jpeg"?h.JPEG:e==="image/png"?h.PNG:e==="image/webp"?h.WEBP:e==="image/svg+xml"?h.SVG:h.UNKNOWN}function je(e){return e===h.AVIF?L.AVIF:e===h.JPEG?L.JPEG:e===h.PNG?L.PNG:e===h.WEBP?L.WEBP:e===h.SVG?L.SVG:L.PNG}function W(e,s){return s<e}function we(e,s){return s>e?`${(100*(s-e)/e).toFixed(2)}%`:s<e?`${(100*(e-s)/e).toFixed(2)}%`:"0%"}function V(e,s){const i=e.split(".");return i[i.length-1]=s,i.join(".")}function ye(e){const{blob:s}=e;return new Promise(async(i,r)=>{const n=new FileReader;n.onload=async a=>{const o=a.target.result;i(o)},n.onerror=r,n.readAsText(s)})}function z(e,s){const{url:i,imageSize:r}=e;return new Promise(async(n,a)=>{try{const o=new Image;o.crossOrigin="anonymous",o.src=i,o.onload=async()=>{const d=document.createElement("canvas");d.width=s.width,d.height=s.height;const x=d.getContext("2d");if(!x){a(new Error("无法创建canvas上下文"));return}x.drawImage(o,0,0,d.width,d.height),n({ctx:x,canvas:d})},o.onerror=d=>{a(d)}}catch(o){a(o instanceof Error?o:new Error("转换过程中发生错误"))}})}function Ne(e,s){const r=new DOMParser().parseFromString(e,"image/svg+xml"),n=r.querySelector("svg");return n?(n.setAttribute("width",`${s.width}px`),n.setAttribute("height",`${s.height}px`),new XMLSerializer().serializeToString(r)):e}const $=({title:e,image:s,onDelete:i})=>{const r=async()=>{const u=await xe(s.blob);ge(u)},{url:n,name:a,fileSize:o,type:d,originalSize:x,error:g}=s,{width:N,height:l}=s.imageSize;return g?t.jsx("div",{className:"process-node-destination",children:t.jsx("div",{className:"process-node-destination-body",children:t.jsx("div",{className:"process-node-destination__error",children:g})})}):t.jsx("div",{className:"process-node-destination",children:t.jsxs("div",{className:"process-node-destination-body",children:[t.jsx("div",{className:"destination-image-container",children:t.jsx(se,{className:"destination-image",src:n,alt:e})}),t.jsxs("div",{className:"process-node-destination__file-info",children:[t.jsx("p",{className:"file-info-item",children:t.jsx("span",{children:a})}),t.jsxs("p",{className:"file-info-item",children:[t.jsxs("span",{children:[d.toUpperCase()," ",`${N} × ${l}`," "]}),t.jsxs("span",{children:[" ",pe(o)," "]})]}),t.jsxs("div",{className:"process-node-destination-footer",children:[x?t.jsxs("span",{className:W(x,o)?"size-down":"size-up",children:[W(x,o)?"↓":"↑",we(x,o)," "]}):t.jsx("span",{children:" "}),t.jsxs("div",{className:"process-node-destination__button-group",children:[t.jsx("a",{href:n,download:a,className:"process-node-destination__link",title:"下载图片",children:t.jsx(me,{})}),t.jsx("a",{href:"javascript:;",onClick:r,className:"process-node-destination__link",title:"复制 Base64",children:t.jsx(ue,{})}),t.jsx("a",{href:"javascript:;",onClick:i,className:"process-node-destination__link",title:"删除",children:t.jsx(he,{})})]})]})]})]})})},_e=({scaleType:e,scaleRatio:s,scaleWidth:i,onChange:r})=>{const n=[.25,.5,1,2,4],a={mode:"spinner",min:1,max:4096,defaultValue:i,onChange:o=>{o!==null&&r(s,o)},style:{width:150}};return t.jsx(t.Fragment,{children:e===U.RATIO?t.jsx("div",{className:"image-scale__controls",children:t.jsx("div",{className:"image-scale__dimensions",children:t.jsx(M.Group,{value:s,onChange:o=>r(o.target.value,i),children:n.map(o=>t.jsxs(M,{className:"image-scale__radio",value:o,children:[o,"x"]},o))})})}):t.jsx("div",{className:"image-scale__controls",children:t.jsx("div",{className:"image-scale-width__dimensions",children:t.jsx(ne,{...a})})})})},be=({onChange:e,onError:s})=>{const[i,r]=S.useState(!1),n=S.useRef(null),a=async l=>{const u=[],P=async v=>{if(v instanceof File){O(v.type)!==h.UNKNOWN&&u.push(v);return}if(v.kind==="file"){const m=v.webkitGetAsEntry();if(m&&m.isDirectory){const j=m.createReader(),b=await new Promise(_=>{j.readEntries(E=>_(E))});for(const _ of b)if(_.isFile){const E=_,R=await new Promise(G=>{E.file(I=>G(I))});O(R.type)!==h.UNKNOWN&&u.push(R)}}else if(m&&m.isFile){const j=m,b=await new Promise(_=>{j.file(E=>_(E))});O(b.type)!==h.UNKNOWN&&u.push(b)}}};if(l instanceof FileList?await Promise.all(Array.from(l).map(P)):await Promise.all(Array.from(l).map(P)),u.length===0){s(new Error("未找到图片文件"));return}e(u)},o=async l=>{l.preventDefault(),r(!1);const u=l.dataTransfer.items;u.length>0&&await a(u)},d=l=>{l.preventDefault(),r(!0)},x=()=>{r(!1)},g=()=>{var l;(l=n.current)==null||l.click()},N=async l=>{var u;(u=l.target.files)!=null&&u.length&&await a(l.target.files)};return t.jsx("div",{className:"process-node-source",children:t.jsxs("div",{className:`process-node-source__upload ${i?"process-node-source__upload--dragging":""}`,onClick:g,onDrop:o,onDragOver:d,onDragLeave:x,children:[t.jsx("h3",{children:"点击或拖放文件/文件夹到此处"}),t.jsx("p",{children:"支持 SVG, WebP, JPG, PNG 等格式"}),t.jsx("input",{type:"file",ref:n,onChange:N,accept:"image/*",multiple:!0,style:{display:"none"}})]})})},Se=({quality:e,imageType:s,scaleType:i,onChange:r})=>t.jsxs("div",{className:"image-converter__options",children:[t.jsxs("div",{className:"image-converter__quality",children:[t.jsxs("label",{htmlFor:"quality",children:[t.jsx("span",{children:"图像质量"}),t.jsx(D,{title:"注意：PNG 格式使用 UPNG 压缩，JPG 格式使用 canvas 压缩，SVG 格式使用 svgo 压缩",color:"#272727",children:t.jsx(k,{style:{marginLeft:"4px",color:"#1677ff"}})}),t.jsx("span",{className:"ml-2x",children:":"})]}),t.jsx(K,{id:"quality",min:0,max:100,value:e,onChange:n=>{r(n,s,i)},tooltip:{formatter:n=>`${n}%`},style:{flex:1,maxWidth:300,margin:"0 8px"}}),t.jsxs("span",{children:[e,"%"]})]}),t.jsxs("div",{className:"image-converter__format",children:[t.jsxs("label",{htmlFor:"quality",children:[t.jsx("span",{children:"文件格式"}),t.jsx(D,{title:"注意：相信我将矢量图转换为位图不是一个明智的选择，最好不要这么做",color:"#272727",children:t.jsx(k,{style:{marginLeft:"4px",color:"#1677ff"}})}),t.jsx("span",{className:"ml-2x",children:":"})]}),t.jsx(T,{className:"image-converter__select",style:{width:"150px"},value:s,onChange:n=>{r(e,n,i)},options:[{value:h.SAME,label:"原格式"},{value:h.PNG,label:"PNG"},{value:h.SVG,label:"SVG"},{value:h.JPEG,label:"JPG"}]})]}),t.jsxs("div",{className:"image-converter__scale",children:[t.jsxs("label",{htmlFor:"quality",children:[t.jsx("span",{children:"缩放类型"}),t.jsx(D,{title:"",color:"#272727",children:t.jsx(k,{style:{marginLeft:"4px",color:"#1677ff"}})}),t.jsx("span",{className:"ml-2x",children:":"})]}),t.jsx(T,{className:"image-converter__select",style:{width:"150px"},value:i,onChange:n=>{r(e,s,n)},options:[{value:U.RATIO,label:"按倍率"},{value:U.WIDTH,label:"按宽度"}]})]})]}),Pe="modulepreload",Ee=function(e){return"/image-tools/"+e},J={},H=function(s,i,r){let n=Promise.resolve();if(i&&i.length>0){let o=function(g){return Promise.all(g.map(N=>Promise.resolve(N).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),x=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));n=o(i.map(g=>{if(g=Ee(g),g in J)return;J[g]=!0;const N=g.endsWith(".css"),l=N?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${l}`))return;const u=document.createElement("link");if(u.rel=N?"stylesheet":Pe,N||(u.as="script"),u.crossOrigin="",u.href=g,x&&u.setAttribute("nonce",x),document.head.appendChild(u),N)return new Promise((P,v)=>{u.addEventListener("load",P),u.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${g}`)))})}))}function a(o){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=o,window.dispatchEvent(d),!d.defaultPrevented)throw o}return n.then(o=>{for(const d of o||[])d.status==="rejected"&&a(d.reason);return s().catch(a)})},Re=()=>H(()=>import("./UPNG-E7GzKVo-.js").then(e=>e.U),__vite__mapDeps([0,1,2])),Ge=()=>H(()=>import("./svgo-node-DQa_Azu-.js").then(e=>e.s),__vite__mapDeps([3,1,2]));function q(e){return Object.values(h).includes(e)?e:h.PNG}function Le(e,s){return e===h.SAME?q(s):q(e)}function Ue(e,s){return s.type===U.RATIO?{width:Math.round(e.width*s.ratio),height:Math.round(e.height*s.ratio)}:{width:s.width,height:Math.round(s.width*e.height/e.width)}}const Ie=async(e,s)=>{const{url:i,name:r,blob:n,type:a,fileSize:o,imageSize:d}=e,{scale:x,quality:g,type:N}=s,l=Le(N,a),u=Ue(d,x);return await ve(50),console.log(a,"=>",l,"quality:",g),a===h.SVG&&l===h.SVG?new Promise(async(P,v)=>{try{const m=await ye(e),j=Ne(m,u),{optimize:b}=await Ge(),_=await b(j),E=new Blob([_.data],{type:L.SVG}),R=URL.createObjectURL(E);P({url:R,name:V(r,"svg"),blob:E,originalSize:o,type:h.SVG,dimensions:u})}catch(m){v(m instanceof Error?m:new Error("转换过程中发生错误"))}}):a!==h.SVG&&l===h.SVG?Promise.reject(new Error("仅支持 SVG 到 SVG 的转换")):l===h.PNG?new Promise(async(P,v)=>{try{const{ctx:m,canvas:j}=await z(e,u),_=m.getImageData(0,0,j.width,j.height).data.buffer,{encode:E}=await Re(),R=E([_],j.width,j.height,Math.round((100-g)*2.56)),G=new Blob([R],{type:L.PNG}),I=URL.createObjectURL(G);P({url:I,name:V(r,"png"),blob:G,originalSize:o,type:h.PNG,dimensions:{width:j.width,height:j.height}})}catch(m){v(m instanceof Error?m:new Error("转换过程中发生错误"))}}):new Promise(async(P,v)=>{try{const{canvas:m}=await z(e,u),j=b=>{if(!b){v(new Error("转换失败，浏览器可能不支持"+l+"编码"));return}const _=URL.createObjectURL(b);P({url:_,name:V(r,l),blob:b,originalSize:o,type:l,dimensions:{width:m.width,height:m.height}})};m.toBlob(j,je(l),g/100)}catch(m){v(m instanceof Error?m:new Error("转换过程中发生错误"))}})},Oe=()=>{const[e,s]=S.useState(0),[i,r]=S.useState([]),[n,a]=S.useState([]),[o,d]=S.useState(!1),[x,g]=S.useState(0),[N,l]=S.useState(100),[u,P]=S.useState(h.SAME),[v,m]=S.useState(U.RATIO),[j,b]=S.useState(1),[_,E]=S.useState(256),[R,G]=S.useState(""),I=async c=>{G("");const f=[];for(const p of c){const y=URL.createObjectURL(p),te=await fe(y);f.push({id:de(),url:y,name:p.name,fileSize:p.size,type:O(p.type),blob:p,imageSize:te})}r(p=>p.concat(f)),a([])},A=c=>{G(c instanceof Error?c.message:"处理图片时出错")},Q=async()=>{if(i.length===0){G("请选择图片");return}d(!0);try{G(""),g(0);const c=[];for(let f=0;f<i.length;f++){const p=i[f];try{const y=await Ie(p,{type:u,quality:N,scale:{type:v,ratio:j,width:_}});c.push({id:p.id,url:y.url,name:y.name,fileSize:y.blob.size,type:y.type,blob:y.blob,originalSize:y.originalSize,imageSize:y.dimensions})}catch(y){c.push({...p,error:y.message})}a(c),g(Math.round((f+1)/i.length*100))}a(c)}catch(c){A(c)}d(!1)},X=c=>{URL.revokeObjectURL(c.url),r(p=>p.filter(y=>y.id!==c.id));const f=n.find(p=>p.id===c.id);f&&URL.revokeObjectURL(f.url),a(p=>p.filter(y=>y.id!==c.id)),s(p=>p+1)},Y=c=>{URL.revokeObjectURL(c.url),a(f=>f.filter(p=>p.id!==c.id))},Z=()=>{i.forEach(c=>{URL.revokeObjectURL(c.url)}),n.forEach(c=>{URL.revokeObjectURL(c.url)}),r([]),a([]),s(c=>c+1)},ee=()=>{n.forEach(c=>{URL.revokeObjectURL(c.url)}),a([])};return t.jsx("div",{className:"image-tool",children:t.jsxs("div",{className:"image-tool__body",children:[t.jsxs("div",{className:"image-tool__input",children:[t.jsx("div",{className:"image-tool__preview-title",children:"图片配置"}),t.jsx(be,{onChange:I,onError:A},e),t.jsx(Se,{quality:N,imageType:u,scaleType:v,onChange:(c,f,p)=>{l(c),P(f),m(p)}}),t.jsx(_e,{scaleType:v,scaleRatio:j,scaleWidth:_,onChange:(c,f)=>{b(c),E(f)}}),t.jsxs("button",{className:"image-tool__button",onClick:Q,disabled:i.length===0||o,children:[o?"正在处理":"开始处理"," (",i.length," 张图片)"]}),i.length>0&&t.jsx(t.Fragment,{children:t.jsxs("div",{style:{marginTop:"16px",padding:"0 10px"},children:[t.jsx(K,{value:x}),t.jsx("div",{style:{textAlign:"center",marginTop:"8px"},children:t.jsxs("div",{className:"image-tool__status",children:["处理进度：",x,"%"]})})]})}),R&&t.jsx("div",{className:"image-tool__error",children:R})]}),t.jsx("div",{className:"image-tool__output",children:i.length>0&&t.jsxs("div",{className:"image-tool__preview",children:[t.jsxs("div",{className:"image-tool__preview-group",children:[t.jsxs("div",{className:"image-tool__preview-head",children:[t.jsx("div",{className:"image-tool__preview-title",children:"原始图片"}),t.jsx(B,{className:"process-node-destination__link",onClick:Z,style:{fontSize:"16px",cursor:"pointer"}})]}),t.jsx("div",{className:"image-tool__preview-list",children:i.map(c=>t.jsx($,{title:`原始图片 ${i.findIndex(f=>f.id===c.id)+1}`,image:c,onDelete:()=>X(c)},c.id))})]}),n.length>0&&t.jsxs("div",{className:"image-tool__preview-group",children:[t.jsxs("div",{className:"image-tool__preview-head",children:[t.jsx("div",{className:"image-tool__preview-title",children:"处理后图片"}),t.jsx(B,{className:"process-node-destination__link",onClick:ee,style:{fontSize:"16px",cursor:"pointer"}})]}),t.jsx("div",{className:"image-tool__preview-list",children:n.map(c=>t.jsx($,{title:`处理后图片 ${n.findIndex(f=>f.id===c.id)+1}`,image:c,onDelete:()=>Y(c)},c.id))})]})]})})]})})};function De(){return t.jsxs("span",{className:"mac-dots",children:[t.jsx("span",{className:"mac-dot mac-dot--red"}),t.jsx("span",{className:"mac-dot mac-dot--yellow"}),t.jsx("span",{className:"mac-dot mac-dot--green"})]})}function ke(){return t.jsxs("div",{className:"layout-header",children:[t.jsx(De,{}),t.jsx("div",{className:"layout-header-right",children:t.jsx("h1",{className:"layout-header-title",children:"欢迎使用图片工具箱，免费在线压缩您的 SVG, WebP, JPEG 和 PNG 图片，纯本地运行无需上传至服务器"})}),t.jsx("a",{className:"github-link",href:"https://github.com/gausstool/image-tools",children:"Github"})]})}function Ce(){return t.jsx(Oe,{})}function Ve(){return t.jsx("div",{className:"layout__body",children:t.jsx(Ce,{})})}function Ae(){return t.jsx("div",{className:"layout",children:t.jsx("div",{className:"layout__container app-container",children:t.jsxs("div",{className:"layout__container--inner ",children:[t.jsx(ke,{}),t.jsx(Ve,{})]})})})}re.createRoot(document.getElementById("root")).render(t.jsx(ie.StrictMode,{children:t.jsx(Ae,{})}));
